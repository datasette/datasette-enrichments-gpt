{% extends "enrichment.html" %}

{% block below_form %}
<script>
const modelSelect = document.querySelector('#model');
const divForImageUrlLabel = document.querySelector('label[for="image_url"]').parentNode;
const divForImageUrlInput = document.querySelector('#image_url').parentNode;
const divForJsonFormatLabel = document.querySelector('label[for="json_format"]').parentNode;
const divForJsonFormatInput = document.querySelector('#json_format').parentNode;
function handleModelChange() {
    // If gpt-4-vision-preview, hide JSON, show image URL
    if (modelSelect.value === 'gpt-4-vision') {
        divForImageUrlLabel.style.display = '';
        divForImageUrlInput.style.display = '';
        divForJsonFormatLabel.style.display = 'none';
        divForJsonFormatInput.style.display = 'none';
    } else {
        divForImageUrlLabel.style.display = 'none';
        divForImageUrlInput.style.display = 'none';
        divForJsonFormatLabel.style.display = '';
        divForJsonFormatInput.style.display = '';
    }
}
modelSelect.addEventListener('change', handleModelChange);
handleModelChange();

// Add "Estimate cost" button to the form
const estimateButton = document.createElement('button');
estimateButton.type = 'button';
estimateButton.textContent = 'Estimate cost';
estimateButton.id = 'estimate-cost';
document.querySelector('form').appendChild(estimateButton);

// Display area for estimated cost
const estimateDisplay = document.createElement('div');
estimateDisplay.id = 'estimate-display';
document.querySelector('form').appendChild(estimateDisplay);

// Implement JavaScript to handle button click and fetch API endpoint
estimateButton.addEventListener('click', async () => {
    const formData = new FormData(document.querySelector('form'));
    const response = await fetch('/-/enrichments-gpt/estimate', {
        method: 'POST',
        body: formData
    });
    const data = await response.json();
    estimateDisplay.textContent = `Estimated cost: ${data.estimated_tokens} tokens`;
});
</script>
{% endblock %}
